{"version":3,"file":"validation-view.element-CRUWIUPv.js","sources":["../../../Client/src/validation/types.ts","../../../Client/src/views/validation-view.element.ts"],"sourcesContent":["// Enum for validation severity levels to match backend\r\nexport enum ValidationSeverity {\r\n    Error = 'Error',\r\n    Warning = 'Warning',\r\n    Info = 'Info'\r\n}\r\n\r\n// Type-safe literal types for notification colors\r\nexport type NotificationColor = 'danger' | 'warning' | 'default' | 'positive';\r\n\r\nexport interface ValidationMessage {\r\n    message: string;\r\n    severity: ValidationSeverity;\r\n}\r\n\r\nexport interface ValidationResult {\r\n    contentId: string;\r\n    hasValidator: boolean;\r\n    messages: ValidationMessage[];\r\n}\r\n","import { customElement, state, html, nothing, repeat, LitElement, type PropertyValues } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbElementMixin } from '@umbraco-cms/backoffice/element-api';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_CONTENT_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/content';\r\nimport { VALIDATION_WORKSPACE_CONTEXT } from '../contexts/validation-workspace-context.js';\r\nimport type { ValidationResult, NotificationColor, ValidationMessage } from '../validation/types.js';\r\nimport { ValidationSeverity } from '../validation/types.js';\r\n\r\nconst SAVE_DELAY_MS = 500;\r\nconst INITIAL_VALIDATION_DELAY_MS = 1000;\r\n\r\nconst SEVERITY_ORDER: Record<ValidationSeverity, number> = {\r\n    [ValidationSeverity.Error]: 0,\r\n    [ValidationSeverity.Warning]: 1,\r\n    [ValidationSeverity.Info]: 2\r\n} as const;\r\n\r\nconst SEVERITY_COLOR_MAP: Record<ValidationSeverity, NotificationColor> = {\r\n    [ValidationSeverity.Error]: 'danger',\r\n    [ValidationSeverity.Warning]: 'warning',\r\n    [ValidationSeverity.Info]: 'default'\r\n} as const;\r\n\r\n@customElement('custom-validator-workspace-view')\r\nexport class CustomValidatorWorkspaceView extends UmbElementMixin(LitElement) {\r\n    #countContext?: typeof VALIDATION_WORKSPACE_CONTEXT.TYPE;\r\n    #contentWorkspace?: typeof UMB_CONTENT_WORKSPACE_CONTEXT.TYPE;\r\n    #currentDocumentId?: string;\r\n    #variantObserverSetup = false;\r\n    #instanceIndexAssigned = false;\r\n\r\n    @state()\r\n    private instanceCount = 0;\r\n    \r\n    @state()\r\n    private _documentId?: string;\r\n    \r\n    @state()\r\n    private _validationResult?: ValidationResult;\r\n    \r\n    @state()\r\n    private _isValidating = false;\r\n    \r\n    @state()\r\n    private _currentCulture?: string;\r\n    \r\n    @state()\r\n    private _cultureReady = false;\r\n    \r\n    constructor() {\r\n        super();\r\n        \r\n        this.consumeContext(VALIDATION_WORKSPACE_CONTEXT, (instance) => {\r\n            if (!instance) return;\r\n            \r\n            this.#countContext = instance;\r\n            \r\n            // Observe the counter\r\n            this.observe(instance.instanceCounter, (count) => {\r\n                // Only assign our index once, using the FIRST value we see\r\n                if (!this.#instanceIndexAssigned) {\r\n                    this.#instanceIndexAssigned = true;\r\n                    this.instanceCount = count;\r\n                    \r\n                    // Increment for the next instance\r\n                    instance.incrementInstance();\r\n                    \r\n                    // Try to set up variant observer now that we have our index\r\n                    this.#trySetupVariantObserver();\r\n                }\r\n            });\r\n        });\r\n        \r\n        this.#setupWorkspaceObservers();\r\n        this.#setupValidationObservers();\r\n        window.addEventListener('custom-validator:validate-all', this.#onGlobalValidateAll);\r\n    }\r\n    \r\n    #setupWorkspaceObservers() {\r\n        this.consumeContext(UMB_CONTENT_WORKSPACE_CONTEXT, (workspace) => {\r\n            if (!workspace) return;\r\n            this.#contentWorkspace = workspace;\r\n            this.#observeDocumentChanges(workspace);\r\n            \r\n            // Try to set up variant observer once we have the workspace\r\n            this.#trySetupVariantObserver();\r\n        });\r\n    }\r\n    \r\n    #trySetupVariantObserver() {\r\n        // Only set up once, and only when both workspace and index are assigned\r\n        if (this.#variantObserverSetup || !this.#contentWorkspace || !this.#instanceIndexAssigned) {\r\n            return;\r\n        }\r\n        \r\n        this.#variantObserverSetup = true;\r\n        this.#observeVariant(this.#contentWorkspace);\r\n    }\r\n    \r\n    #observeVariant(workspace: typeof UMB_CONTENT_WORKSPACE_CONTEXT.TYPE) {\r\n        \r\n        this.observe(\r\n            workspace.splitView.activeVariantByIndex(this.instanceCount),\r\n            async (variant) => {\r\n\r\n                const newCulture = variant?.culture ?? undefined;\r\n                const cultureChanged = this._currentCulture !== newCulture;\r\n                this._currentCulture = newCulture;\r\n                \r\n                if (!this._cultureReady) {\r\n                    this._cultureReady = true;\r\n                }\r\n                \r\n                // Validate on culture change OR first load (no result yet)\r\n                if (this._documentId && (cultureChanged || !this._validationResult)) {\r\n                    await this.#validateAndUpdateResult({ useDelay: true, skipSave: true });\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    #observeDocumentChanges(workspace: typeof UMB_CONTENT_WORKSPACE_CONTEXT.TYPE) {\r\n        this.observe(\r\n            workspace.unique,\r\n            (unique) => {\r\n                const isDocumentSwitch = this.#isDocumentSwitch(unique);\r\n                \r\n                // Clear UI state when switching to a different document\r\n                if (isDocumentSwitch) {\r\n                    this._validationResult = undefined;\r\n                }\r\n                \r\n                // Update tracked document ID\r\n                this._documentId = unique ?? undefined;\r\n                this.#currentDocumentId = unique ?? undefined;\r\n            }\r\n        );\r\n    }\r\n\r\n    #isDocumentSwitch(newDocumentId: string | null | undefined): boolean {\r\n        return this.#currentDocumentId !== undefined && this.#currentDocumentId !== newDocumentId;\r\n    }\r\n\r\n    #setupValidationObservers() {\r\n        this.consumeContext(VALIDATION_WORKSPACE_CONTEXT, (validationContext) => {\r\n            if (!validationContext) return;\r\n\r\n            this.observe(\r\n                validationContext.isValidating,\r\n                (isValidating) => {\r\n                    this._isValidating = isValidating;\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    override willUpdate(changedProperties: PropertyValues) {\r\n        super.willUpdate(changedProperties);\r\n        \r\n        // Recalculate cached computed properties when validation result changes\r\n        if (changedProperties.has('_validationResult')) {\r\n        }\r\n    }\r\n\r\n    override connectedCallback() {\r\n        super.connectedCallback();\r\n    }\r\n\r\n    override disconnectedCallback() {\r\n        super.disconnectedCallback();\r\n        window.removeEventListener('custom-validator:validate-all', this.#onGlobalValidateAll);\r\n        \r\n        // Type-safe reset\r\n        if (this.#countContext) {\r\n            this.#countContext.resetInstanceCounter();\r\n        }\r\n    }\r\n\r\n    // Unified validation method for all cultures\r\n    async #validateAndUpdateResult(options: { useDelay?: boolean; skipSave?: boolean } = {}) {\r\n        if (!this._documentId) return;\r\n\r\n        try {\r\n            const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n            if (!validationContext) return;\r\n\r\n            const performValidation = async () => {\r\n                try {\r\n                    // Save before validation unless explicitly skipped\r\n                    if (!options.skipSave && this.#contentWorkspace?.requestSubmit) {\r\n                        await this.#contentWorkspace.requestSubmit();\r\n                        await this.#delay(SAVE_DELAY_MS);\r\n                    }\r\n\r\n                    const result = await validationContext.validateManually(this._documentId!, this._currentCulture);\r\n                    this._validationResult = result;\r\n\r\n                } catch (error) {\r\n                    console.debug('Validation skipped:', error);\r\n                }\r\n            };\r\n\r\n            // Use delay for initial validation to ensure workspace is fully loaded\r\n            if (options.useDelay) {\r\n                await this.#delay(INITIAL_VALIDATION_DELAY_MS);\r\n            }\r\n\r\n            await performValidation();\r\n        } catch (error) {\r\n            console.error('Failed to validate and update result:', error);\r\n        }\r\n    }\r\n\r\n    #handleValidateClick = async () => {\r\n        // Validate this pane with save\r\n        await this.#validateAndUpdateResult({ skipSave: false });\r\n        // Dispatch global event so all panes validate (but skip save in others)\r\n        window.dispatchEvent(new CustomEvent('custom-validator:validate-all', { detail: { skipSave: true } }));\r\n    };\r\n\r\n    #onGlobalValidateAll = async (event: Event) => {\r\n        // Only validate if this pane is attached and has a document\r\n        if (this.isConnected && this._documentId) {\r\n            // If event has detail.skipSave, use it; otherwise default to true\r\n            let skipSave = true;\r\n            if (event instanceof CustomEvent && typeof event.detail?.skipSave === 'boolean') {\r\n                skipSave = event.detail.skipSave;\r\n            }\r\n            await this.#validateAndUpdateResult({ skipSave });\r\n        }\r\n    }\r\n\r\n    #getMessageCounts(): { errors: number; warnings: number } {\r\n        if (!this._validationResult) {\r\n            return { errors: 0, warnings: 0 };\r\n        }\r\n        return {\r\n            errors: this._validationResult.messages.filter(m => m.severity === ValidationSeverity.Error).length,\r\n            warnings: this._validationResult.messages.filter(m => m.severity === ValidationSeverity.Warning).length\r\n        };\r\n    }\r\n\r\n    #delay(ms: number): Promise<void> {\r\n        return new Promise(resolve => setTimeout(resolve, ms));\r\n    }\r\n\r\n    #getSeverityColor(severity: ValidationSeverity): NotificationColor {\r\n        return SEVERITY_COLOR_MAP[severity];\r\n    }\r\n\r\n    #renderValidationResults() {\r\n\r\n        if (this._isValidating || !this._validationResult) {\r\n            return this.#renderLoadingState();\r\n        }\r\n\r\n        if (!this._validationResult.hasValidator) {\r\n            return html`\r\n                <uui-box headline=\"Status\" headline-variant=\"h5\">\r\n                    <p>No custom validation configured for this document.</p>\r\n                </uui-box>`;\r\n        }\r\n\r\n        const hasErrorsOrWarnings = this._validationResult.messages.some(\r\n            m => m.severity === ValidationSeverity.Error || m.severity === ValidationSeverity.Warning);\r\n\r\n        return html`\r\n            <uui-box headline=\"Validation Results\" headline-variant=\"h5\">\r\n                ${!hasErrorsOrWarnings ? this.#renderSuccessMessage() : nothing}\r\n                ${this._validationResult.messages.length > 0 ? this.#renderMessagesTable(this._validationResult.messages) : nothing}\r\n            </uui-box>\r\n        `;\r\n    }\r\n\r\n    #renderMessagesTable(messages: ValidationMessage[]): unknown {\r\n\r\n        const sortedMessages = [...messages].sort((a, b) => SEVERITY_ORDER[a.severity] - SEVERITY_ORDER[b.severity]);\r\n\r\n        return html`\r\n        <uui-table aria-label=\"Validation Messages\">\r\n                    <uui-table-head>\r\n                        <uui-table-head-cell style=\"width: 120px;\">Severity</uui-table-head-cell>\r\n                        <uui-table-head-cell>Message</uui-table-head-cell>\r\n                    </uui-table-head>\r\n                    ${repeat(\r\n                        sortedMessages ?? [],\r\n                        (msg) => msg.message,\r\n                        (msg) => html`\r\n                            <uui-table-row>\r\n                                <uui-table-cell>\r\n                                    <uui-tag color=${this.#getSeverityColor(msg.severity)} look=\"primary\">\r\n                                        ${msg.severity}\r\n                                    </uui-tag>\r\n                                </uui-table-cell>\r\n                                <uui-table-cell>${msg.message}</uui-table-cell>\r\n                            </uui-table-row>\r\n                        `\r\n                    )}\r\n        </uui-table>`;\r\n    }\r\n\r\n    #renderLoadingState() {\r\n        return html`\r\n            <uui-box headline=\"Status\" headline-variant=\"h5\">\r\n                <div style=\"display: flex; align-items: center; gap: var(--uui-size-space-3);\">\r\n                    <uui-loader></uui-loader>\r\n                    <span>Validating...</span>\r\n                </div>\r\n            </uui-box>\r\n        `;\r\n    }\r\n\r\n    #renderSuccessMessage() {\r\n        return html`\r\n            <p style=\"color: var(--uui-color-positive);\">\r\n                <uui-icon name=\"icon-check\"></uui-icon>\r\n                All validations passed successfully.\r\n            </p>\r\n        `;\r\n    }\r\n\r\n    #renderHeader() {\r\n        const { errors, warnings } = this.#getMessageCounts();\r\n\r\n        return html`\r\n            <div slot=\"headline\">\r\n                ${this.#renderHeaderIcon(errors)}\r\n                Document Validation\r\n            </div>\r\n            <div slot=\"header-actions\">\r\n                ${errors > 0 ? html`\r\n                    <uui-tag color=\"danger\" look=\"primary\">${errors}</uui-tag>\r\n                ` : nothing}\r\n                ${warnings > 0 ? html`\r\n                    <uui-tag color=\"warning\" look=\"primary\">${warnings}</uui-tag>\r\n                ` : nothing}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    #renderHeaderIcon(errorCount: number) {\r\n        return errorCount > 0 \r\n            ? html`<uui-icon name=\"icon-delete\" style=\"color: var(--uui-color-danger);\"></uui-icon>`\r\n            : html`<uui-icon name=\"icon-check\" style=\"color: var(--uui-color-positive);\"></uui-icon>`;\r\n    }\r\n\r\n    #renderControls() {\r\n        return html`\r\n            <uui-button-group>\r\n                <uui-button\r\n                    look=\"primary\"\r\n                    color=\"default\"\r\n                    label=\"Save & Validate\"\r\n                    @click=${this.#handleValidateClick}\r\n                    ?disabled=${!this._documentId || this._isValidating}>\r\n                    Save & Validate\r\n                </uui-button>\r\n                ${this._isValidating ? html`<uui-loader></uui-loader>` : nothing}\r\n            </uui-button-group>\r\n        `;\r\n    }\r\n\r\n    override render() {\r\n        // Show controls if any culture has a validator\r\n        const shouldShowControls = this._validationResult?.hasValidator !== false && this._validationResult !== undefined;\r\n        \r\n        return html`\r\n            <umb-body-layout header-transparent header-fit-height>\r\n                <div style=\"display: flex; flex-direction: column; gap: var(--uui-size-layout-1);\">\r\n                    ${shouldShowControls ? html`\r\n                        <uui-box headline-variant=\"h4\">\r\n                            ${this.#renderHeader()}\r\n                            ${this.#renderControls()}\r\n                        </uui-box>\r\n                    ` : nothing}\r\n\r\n                    ${this.#renderValidationResults()}\r\n                </div>\r\n            </umb-body-layout>\r\n        `;\r\n    }\r\n\r\n    static override styles = [UmbTextStyles];\r\n}\r\n\r\nexport { CustomValidatorWorkspaceView as element };\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'custom-validator-workspace-view': CustomValidatorWorkspaceView;\r\n    }\r\n}\r\n"],"names":["ValidationSeverity","_countContext","_contentWorkspace","_currentDocumentId","_variantObserverSetup","_instanceIndexAssigned","_CustomValidatorWorkspaceView_instances","setupWorkspaceObservers_fn","trySetupVariantObserver_fn","observeVariant_fn","observeDocumentChanges_fn","isDocumentSwitch_fn","setupValidationObservers_fn","validateAndUpdateResult_fn","_handleValidateClick","_onGlobalValidateAll","getMessageCounts_fn","delay_fn","getSeverityColor_fn","renderValidationResults_fn","renderMessagesTable_fn","renderLoadingState_fn","renderSuccessMessage_fn","renderHeader_fn","renderHeaderIcon_fn","renderControls_fn","SAVE_DELAY_MS","INITIAL_VALIDATION_DELAY_MS","SEVERITY_ORDER","SEVERITY_COLOR_MAP","CustomValidatorWorkspaceView","UmbElementMixin","LitElement","__privateAdd","__privateMethod","event","skipSave","VALIDATION_WORKSPACE_CONTEXT","instance","__privateSet","count","__privateGet","changedProperties","shouldShowControls","html","nothing","UMB_CONTENT_WORKSPACE_CONTEXT","workspace","variant","newCulture","cultureChanged","unique","newDocumentId","validationContext","isValidating","options","performValidation","result","error","m","ms","resolve","severity","hasErrorsOrWarnings","messages","sortedMessages","a","b","repeat","msg","errors","warnings","errorCount","UmbTextStyles","__decorateClass","state","customElement"],"mappings":"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"}