{"version":3,"file":"validation-workspace-context-C5LC-9vh.js","sources":["../../../Client/src/apis/validation-api.service.ts","../../../Client/src/contexts/validation-workspace-context.ts"],"sourcesContent":["import type { ValidationResult } from '../validation/types.js';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\n\r\nexport class ValidationApiService extends UmbControllerBase {\r\n    private readonly baseUrl: string;\r\n    \r\n    constructor(host: UmbControllerHost) {\r\n        super(host);\r\n        this.baseUrl = `${window.location.origin}/umbraco/management/api/v1/validation`;\r\n    }\r\n    \r\n    async validateDocument(\r\n        id: string, \r\n        culture?: string,\r\n    ): Promise<ValidationResult> {\r\n        try {\r\n            const authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n            const token = await authContext?.getLatestToken();\r\n            \r\n            if (!token) {\r\n                throw new Error('Authentication token not available');\r\n            }\r\n            \r\n            const url = new URL(`${this.baseUrl}/validate/${encodeURIComponent(id)}`);\r\n            \r\n            if(culture) {\r\n                url.searchParams.append('culture', culture);\r\n            }\r\n\r\n            const response = await fetch(url, {\r\n                method: 'GET',\r\n                headers: {\r\n                    'Authorization': `Bearer ${token}`,\r\n                    'Content-Type': 'application/json',\r\n                }\r\n            });\r\n            \r\n            if (!response.ok) {\r\n                const errorMessage = await this.extractErrorMessage(response);\r\n                throw new Error(errorMessage);\r\n            }\r\n            \r\n            const result = await response.json();\r\n            return result || {};\r\n            \r\n        } catch (error) {\r\n            throw new Error(error instanceof Error ? error.message : String(error));\r\n        }\r\n    }\r\n    \r\n    private async extractErrorMessage(response: Response): Promise<string> {\r\n        const defaultMessage = `Validation request failed: ${response.status} ${response.statusText}`;\r\n        \r\n        try {\r\n            const errorData = await response.json();\r\n            return errorData.detail || errorData.title || errorData.message || defaultMessage;\r\n        } catch {\r\n            return defaultMessage;\r\n        }\r\n    }\r\n}\r\n","import { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { ValidationApiService } from '../apis/validation-api.service.js';\r\nimport type { ValidationResult } from '../validation/types.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport { UmbObjectState, UmbNumberState } from '@umbraco-cms/backoffice/observable-api';\r\n\r\nexport class ValidationWorkspaceContext extends UmbContextBase {\r\n    #apiService = new ValidationApiService(this);\r\n    #isValidating = new UmbObjectState<boolean>(false);\r\n\r\n    #istanceCounter = new UmbNumberState(0);\r\n    readonly instanceCounter = this.#istanceCounter.asObservable();\r\n\r\n    public readonly isValidating = this.#isValidating.asObservable();\r\n\r\n    constructor(host: UmbControllerHost) {\r\n        super(host, VALIDATION_WORKSPACE_CONTEXT);\r\n    }\r\n\r\n    incrementInstance() {\r\n        this.#istanceCounter.setValue(this.#istanceCounter.value + 1);\r\n    }\r\n\r\n    resetInstanceCounter() {\r\n        this.#istanceCounter.setValue(0);\r\n    }\r\n\r\n    async validateManually(documentId: string, culture?: string): Promise<ValidationResult> {\r\n        this.#isValidating.setValue(true);\r\n        try {\r\n            return await this.#apiService.validateDocument(documentId, culture);\r\n        } catch (error) {\r\n            console.error('Manual validation failed:', error);\r\n            throw error;\r\n        } finally {\r\n            this.#isValidating.setValue(false);\r\n        }\r\n    }\r\n}\r\n\r\nexport { ValidationWorkspaceContext as api };\r\n\r\nexport const VALIDATION_WORKSPACE_CONTEXT = new UmbContextToken<ValidationWorkspaceContext>(\r\n    'UmbWorkspaceContext',\r\n    'ValidationWorkspaceContext'\r\n);"],"names":["ValidationApiService","UmbControllerBase","host","id","culture","token","UMB_AUTH_CONTEXT","url","response","errorMessage","error","defaultMessage","errorData","ValidationWorkspaceContext","UmbContextBase","VALIDATION_WORKSPACE_CONTEXT","#apiService","#isValidating","UmbObjectState","#istanceCounter","UmbNumberState","documentId","UmbContextToken"],"mappings":";;;;AAKO,MAAMA,UAA6BC,EAAkB;AAAA,EAGxD,YAAYC,GAAyB;AACjC,UAAMA,CAAI,GACV,KAAK,UAAU,GAAG,OAAO,SAAS,MAAM;AAAA,EAC5C;AAAA,EAEA,MAAM,iBACFC,GACAC,GACyB;AACzB,QAAI;AAEA,YAAMC,IAAQ,OADM,MAAM,KAAK,WAAWC,CAAgB,IACzB,eAAA;AAEjC,UAAI,CAACD;AACD,cAAM,IAAI,MAAM,oCAAoC;AAGxD,YAAME,IAAM,IAAI,IAAI,GAAG,KAAK,OAAO,aAAa,mBAAmBJ,CAAE,CAAC,EAAE;AAExE,MAAGC,KACCG,EAAI,aAAa,OAAO,WAAWH,CAAO;AAG9C,YAAMI,IAAW,MAAM,MAAMD,GAAK;AAAA,QAC9B,QAAQ;AAAA,QACR,SAAS;AAAA,UACL,eAAiB,UAAUF,CAAK;AAAA,UAChC,gBAAgB;AAAA,QAAA;AAAA,MACpB,CACH;AAED,UAAI,CAACG,EAAS,IAAI;AACd,cAAMC,IAAe,MAAM,KAAK,oBAAoBD,CAAQ;AAC5D,cAAM,IAAI,MAAMC,CAAY;AAAA,MAChC;AAGA,aADe,MAAMD,EAAS,KAAA,KACb,CAAA;AAAA,IAErB,SAASE,GAAO;AACZ,YAAM,IAAI,MAAMA,aAAiB,QAAQA,EAAM,UAAU,OAAOA,CAAK,CAAC;AAAA,IAC1E;AAAA,EACJ;AAAA,EAEA,MAAc,oBAAoBF,GAAqC;AACnE,UAAMG,IAAiB,8BAA8BH,EAAS,MAAM,IAAIA,EAAS,UAAU;AAE3F,QAAI;AACA,YAAMI,IAAY,MAAMJ,EAAS,KAAA;AACjC,aAAOI,EAAU,UAAUA,EAAU,SAASA,EAAU,WAAWD;AAAA,IACvE,QAAQ;AACJ,aAAOA;AAAA,IACX;AAAA,EACJ;AACJ;ACvDO,MAAME,UAAmCC,EAAe;AAAA,EAS3D,YAAYZ,GAAyB;AACjC,UAAMA,GAAMa,CAA4B,GAT5C,KAAAC,KAAc,IAAIhB,EAAqB,IAAI,GAC3C,KAAAiB,KAAgB,IAAIC,EAAwB,EAAK,GAEjD,KAAAC,KAAkB,IAAIC,EAAe,CAAC,GACtC,KAAS,kBAAkB,KAAKD,GAAgB,aAAA,GAEhD,KAAgB,eAAe,KAAKF,GAAc,aAAA;AAAA,EAIlD;AAAA,EAVAD;AAAA,EACAC;AAAA,EAEAE;AAAA,EASA,oBAAoB;AAChB,SAAKA,GAAgB,SAAS,KAAKA,GAAgB,QAAQ,CAAC;AAAA,EAChE;AAAA,EAEA,uBAAuB;AACnB,SAAKA,GAAgB,SAAS,CAAC;AAAA,EACnC;AAAA,EAEA,MAAM,iBAAiBE,GAAoBjB,GAA6C;AACpF,SAAKa,GAAc,SAAS,EAAI;AAChC,QAAI;AACA,aAAO,MAAM,KAAKD,GAAY,iBAAiBK,GAAYjB,CAAO;AAAA,IACtE,SAASM,GAAO;AACZ,oBAAQ,MAAM,6BAA6BA,CAAK,GAC1CA;AAAA,IACV,UAAA;AACI,WAAKO,GAAc,SAAS,EAAK;AAAA,IACrC;AAAA,EACJ;AACJ;AAIO,MAAMF,IAA+B,IAAIO;AAAA,EAC5C;AAAA,EACA;AACJ;"}