{"version":3,"file":"validation-view.element-D6SB2QmR.js","sources":["../../TestExtension/client/src/validation/validation-view.element.ts"],"sourcesContent":["import { customElement, state, html, nothing, repeat } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_CONTENT_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/content';\r\nimport { UMB_NOTIFICATION_CONTEXT } from '@umbraco-cms/backoffice/notification';\r\nimport type { UmbWorkspaceViewElement } from '@umbraco-cms/backoffice/workspace';\r\nimport { VALIDATION_WORKSPACE_CONTEXT } from './validation-workspace-context.js';\r\nimport type { ValidationResult, ValidationMessage } from './types.js';\r\n\r\n// Module-level map to track which documents have been validated\r\nconst validatedDocuments = new Map<string, boolean>();\r\n\r\n// Track instance registration order for split view detection\r\nlet instanceCounter = 0;\r\nconst instanceResetTimer: any = null;\r\n\r\n@customElement('my-validation-workspace-view')\r\nexport class MyValidationWorkspaceView extends UmbLitElement implements UmbWorkspaceViewElement {\r\n    #instanceId: number;\r\n    @state()\r\n    private _documentId?: string;\r\n\r\n    @state()\r\n    private _validationResult?: ValidationResult;\r\n\r\n    @state()\r\n    private _isValidating = false;\r\n\r\n    @state()\r\n    private _currentCulture?: string;\r\n\r\n    #contentWorkspace?: typeof UMB_CONTENT_WORKSPACE_CONTEXT.TYPE;\r\n    #currentDocumentId?: string;\r\n\r\n    constructor() {\r\n        super();\r\n        \r\n        // Assign unique instance ID for split view detection\r\n        this.#instanceId = instanceCounter++;\r\n        // Reset counter after a delay (new document or view changes)\r\n        setTimeout(() => { if (instanceCounter > 1) instanceCounter = 0; }, 2000);\r\n\r\n        this.consumeContext(UMB_CONTENT_WORKSPACE_CONTEXT, (workspace) => {\r\n            if (!workspace) return;\r\n\r\n            this.#contentWorkspace = workspace;\r\n\r\n            // Observe the active variant to track culture for this specific split view\r\n            this.observe(\r\n                workspace.splitView.activeVariantsInfo,\r\n                async (variants) => {\r\n                    if (variants && variants.length > 0) {\r\n                        // Use instance ID to determine which variant this view represents\r\n                        // In split view: instance 0 = variant 0, instance 1 = variant 1\r\n                        // In single view: always use first variant\r\n                        const variantIndex = variants.length > 1 ? Math.min(this.#instanceId, variants.length - 1) : 0;\r\n                        const variant = variants[variantIndex];\r\n                        \r\n                        const newCulture = variant?.culture ?? undefined;\r\n                        \r\n                        // Only update if culture actually changed\r\n                        if (this._currentCulture !== newCulture) {\r\n                            this._currentCulture = newCulture;\r\n                            \r\n                            // Notify validation context of the active culture for this view\r\n                            const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n                            if (validationContext) {\r\n                                validationContext.setActiveCulture(this._currentCulture);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        this._currentCulture = undefined;\r\n                    }\r\n                }\r\n            );\r\n\r\n            this.observe(\r\n                workspace.unique,\r\n                async (unique) => {\r\n                    const previousDocumentId = this.#currentDocumentId;\r\n                    this._documentId = unique ?? undefined;\r\n                    this.#currentDocumentId = unique ?? undefined;\r\n\r\n                    // Clear validation results when switching documents\r\n                    const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n                    if (validationContext) {\r\n                        validationContext.clearValidation();\r\n                    }\r\n                    \r\n                    // Only reset validation flag when truly switching between different documents\r\n                    if (previousDocumentId !== undefined && previousDocumentId !== unique) {\r\n                        if (unique) {\r\n                            validatedDocuments.delete(unique);\r\n                        }\r\n                    }\r\n                }\r\n            );\r\n        });\r\n\r\n        this.consumeContext(VALIDATION_WORKSPACE_CONTEXT, (validationContext) => {\r\n            if (!validationContext) return;\r\n\r\n            this.observe(\r\n                validationContext.validationResult,\r\n                (result) => {\r\n                    this._validationResult = result;\r\n                }\r\n            );\r\n\r\n            this.observe(\r\n                validationContext.isValidating,\r\n                (isValidating) => {\r\n                    this._isValidating = isValidating;\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n\r\n\r\n    override connectedCallback() {\r\n        super.connectedCallback();\r\n        \r\n        const hasValidatedOnce = this._documentId ? validatedDocuments.get(this._documentId) ?? false : false;\r\n        \r\n        // Validate when tab becomes visible\r\n        if (this._documentId) {\r\n            if (!hasValidatedOnce) {\r\n                validatedDocuments.set(this._documentId, true);\r\n                this.#validateWithoutSave();\r\n            } else {\r\n                this.#revalidateOnTabSwitch();\r\n            }\r\n        }\r\n    }\r\n\r\n    async #validateWithoutSave() {\r\n        if (!this._documentId) return;\r\n\r\n        const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n        if (!validationContext) return;\r\n\r\n        // Skip validation entirely if we already know there's no validator\r\n        if (this._validationResult?.hasValidator === false) {\r\n            return;\r\n        }\r\n\r\n        // Small delay to ensure workspace is fully loaded\r\n        setTimeout(async () => {\r\n            try {\r\n                await validationContext.validateManually(this._documentId!, this._currentCulture);\r\n            } catch (error) {\r\n                console.debug('Validation skipped:', error);\r\n            }\r\n        }, 1000);\r\n    }\r\n\r\n    async #revalidateOnTabSwitch() {\r\n        if (!this._documentId) return;\r\n\r\n        const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n        if (!validationContext) return;\r\n\r\n        // Skip validation entirely if we already know there's no validator\r\n        if (this._validationResult?.hasValidator === false) {\r\n            return;\r\n        }\r\n\r\n        // On tab switch, just validate current state without saving\r\n        // This avoids triggering save modals for language selection\r\n        try {\r\n            await validationContext.validateManually(this._documentId, this._currentCulture);\r\n        } catch (error) {\r\n            console.debug('Auto-validation on tab switch skipped:', error);\r\n        }\r\n    }\r\n\r\n    #handleValidateClick = async () => {\r\n        if (!this._documentId) return;\r\n\r\n        const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n        if (!validationContext) return;\r\n\r\n        // Skip validation entirely if we already know there's no validator\r\n        if (this._validationResult?.hasValidator === false) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Request save to update preview content before validation\r\n            if (this.#contentWorkspace?.requestSubmit) {\r\n                await this.#contentWorkspace.requestSubmit();\r\n                // Small delay to allow content cache to update\r\n                await new Promise(resolve => setTimeout(resolve, 500));\r\n            }\r\n            \r\n            await validationContext.validateManually(this._documentId, this._currentCulture);\r\n        } catch (error) {\r\n            // Silently handle validation errors\r\n        }\r\n    };\r\n\r\n    #handleSaveAndPublishClick = async () => {\r\n        if (!this._documentId) return;\r\n\r\n        const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n        if (!validationContext) return;\r\n\r\n        const notificationContext = await this.getContext(UMB_NOTIFICATION_CONTEXT);\r\n\r\n        // Skip if no validator\r\n        if (this._validationResult?.hasValidator === false) {\r\n            return;\r\n        }\r\n\r\n        try {\r\n            // Save and validate first\r\n            if (this.#contentWorkspace?.requestSubmit) {\r\n                await this.#contentWorkspace.requestSubmit();\r\n                await new Promise(resolve => setTimeout(resolve, 500));\r\n            }\r\n            \r\n            await validationContext.validateManually(this._documentId, this._currentCulture);\r\n\r\n            // Check if there are blocking errors\r\n            if (validationContext.hasBlockingErrors()) {\r\n                notificationContext?.peek('danger', {\r\n                    data: {\r\n                        headline: 'Cannot Publish',\r\n                        message: 'Validation errors must be resolved first'\r\n                    }\r\n                });\r\n                return;\r\n            }\r\n\r\n            // Publish if no errors\r\n            if (this.#contentWorkspace && 'publish' in this.#contentWorkspace && typeof this.#contentWorkspace.publish === 'function') {\r\n                await this.#contentWorkspace.publish();\r\n            }\r\n        } catch (error) {\r\n            notificationContext?.peek('danger', {\r\n                data: {\r\n                    headline: 'Error',\r\n                    message: error instanceof Error ? error.message : 'Save and publish failed'\r\n                }\r\n            });\r\n        }\r\n    };\r\n\r\n    #getSeverityColor(severity: string): string {\r\n        switch (severity.toLowerCase()) {\r\n            case 'error':\r\n                return 'danger';\r\n            case 'warning':\r\n                return 'warning';\r\n            case 'info':\r\n            default:\r\n                return 'default';\r\n        }\r\n    }\r\n\r\n    #renderValidationResults() {\r\n        // Loading state or no validation result yet\r\n        if (this._isValidating || !this._validationResult) {\r\n            return html`\r\n                <uui-box headline=\"Status\" headline-variant=\"h5\">\r\n                    <div style=\"display: flex; align-items: center; gap: var(--uui-size-space-3);\">\r\n                        <uui-loader></uui-loader>\r\n                        <span>Validating...</span>\r\n                    </div>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        // No validator configured\r\n        if (!this._validationResult.hasValidator) {\r\n            return html`\r\n                <uui-box headline=\"Status\" headline-variant=\"h5\">\r\n                    <p>No validation configured for this content type (${this._validationResult.contentTypeAlias}).</p>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        // Validation messages - sorted by severity (Error > Warning > Info)\r\n        const sortedMessages = [...this._validationResult.messages].sort((a, b) => {\r\n            const severityOrder = { 'Error': 0, 'Warning': 1, 'Info': 2 };\r\n            return (severityOrder[a.severity as keyof typeof severityOrder] ?? 3) - \r\n                   (severityOrder[b.severity as keyof typeof severityOrder] ?? 3);\r\n        });\r\n\r\n        // Check if there are only info messages (no errors or warnings)\r\n        const hasErrorsOrWarnings = this._validationResult.messages.some(\r\n            m => m.severity === 'Error' || m.severity === 'Warning'\r\n        );\r\n\r\n        return html`\r\n            <uui-box headline=\"Validation Results\" headline-variant=\"h5\">\r\n                ${!hasErrorsOrWarnings ? html`\r\n                    <p style=\"color: var(--uui-color-positive);\">\r\n                        <uui-icon name=\"icon-check\"></uui-icon>\r\n                        All validations passed successfully.\r\n                    </p>\r\n                ` : nothing}\r\n                <div>\r\n                    ${repeat(\r\n                        sortedMessages,\r\n                        (msg) => msg.message,\r\n                        (msg) => this.#renderValidationMessage(msg)\r\n                    )}\r\n                </div>\r\n            </uui-box>\r\n        `;\r\n    }\r\n\r\n    #renderValidationMessage(msg: ValidationMessage) {\r\n        const color = this.#getSeverityColor(msg.severity);\r\n\r\n        return html`\r\n            <p>\r\n                <uui-tag color=${color} look=\"primary\">\r\n                    ${msg.severity}\r\n                </uui-tag>\r\n                ${msg.message}\r\n            </p>\r\n        `;\r\n    }\r\n\r\n    #getErrorCount(): number {\r\n        if (!this._validationResult) return 0;\r\n        return this._validationResult.messages.filter(m => m.severity === 'Error').length;\r\n    }\r\n\r\n    #getWarningCount(): number {\r\n        if (!this._validationResult) return 0;\r\n        return this._validationResult.messages.filter(m => m.severity === 'Warning').length;\r\n    }\r\n\r\n    #renderHeader() {\r\n        const errorCount = this.#getErrorCount();\r\n        const warningCount = this.#getWarningCount();\r\n\r\n        return html`\r\n            <div slot=\"headline\">\r\n                ${errorCount > 0 ? html`\r\n                    <uui-icon name=\"icon-delete\" style=\"color: var(--uui-color-danger);\"></uui-icon>\r\n                ` : html`\r\n                    <uui-icon name=\"icon-check\" style=\"color: var(--uui-color-positive);\"></uui-icon>\r\n                `}\r\n                Document Validation\r\n            </div>\r\n            <div slot=\"header-actions\">\r\n                ${errorCount > 0 ? html`\r\n                    <uui-tag color=\"danger\" look=\"primary\">${errorCount}</uui-tag>\r\n                ` : nothing}\r\n                ${warningCount > 0 ? html`\r\n                    <uui-tag color=\"warning\" look=\"primary\">${warningCount}</uui-tag>\r\n                ` : nothing}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    override render() {\r\n        return html`\r\n            <umb-body-layout header-transparent header-fit-height>\r\n                <div style=\"display: flex; flex-direction: column; gap: var(--uui-size-layout-1);\">\r\n                    ${this._validationResult?.hasValidator !== false && this._validationResult !== undefined ? html`\r\n                        <uui-box headline-variant=\"h4\">\r\n                            ${this.#renderHeader()}\r\n                            <uui-button-group>\r\n                                <uui-button\r\n                                    look=\"primary\"\r\n                                    color=\"default\"\r\n                                    label=\"Save & Validate\"\r\n                                    @click=${this.#handleValidateClick}\r\n                                    ?disabled=${!this._documentId || this._isValidating}>\r\n                                    Save & Validate\r\n                                </uui-button>\r\n                                <uui-button\r\n                                    look=\"primary\"\r\n                                    color=\"positive\"\r\n                                    label=\"Validate & Publish\"\r\n                                    @click=${this.#handleSaveAndPublishClick}\r\n                                    ?disabled=${!this._documentId || this._isValidating}>\r\n                                    Validate & Publish\r\n                                </uui-button>\r\n                                ${this._isValidating ? html`<uui-loader></uui-loader>` : nothing}\r\n                            </uui-button-group>\r\n                        </uui-box>\r\n                    ` : nothing}\r\n\r\n                    ${this.#renderValidationResults()}\r\n                </div>\r\n            </umb-body-layout>\r\n        `;\r\n    }\r\n\r\n    static override styles = [UmbTextStyles];\r\n}\r\n\r\nexport { MyValidationWorkspaceView as element };\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'my-validation-workspace-view': MyValidationWorkspaceView;\r\n    }\r\n}\r\n"],"names":["_instanceId","_contentWorkspace","_currentDocumentId","_MyValidationWorkspaceView_instances","validateWithoutSave_fn","revalidateOnTabSwitch_fn","_handleValidateClick","_handleSaveAndPublishClick","getSeverityColor_fn","renderValidationResults_fn","renderValidationMessage_fn","getErrorCount_fn","getWarningCount_fn","renderHeader_fn","validatedDocuments","instanceCounter","MyValidationWorkspaceView","UmbLitElement","__privateAdd","validationContext","VALIDATION_WORKSPACE_CONTEXT","__privateGet","resolve","notificationContext","UMB_NOTIFICATION_CONTEXT","error","__privateSet","UMB_CONTENT_WORKSPACE_CONTEXT","workspace","variants","variantIndex","newCulture","unique","previousDocumentId","result","isValidating","hasValidatedOnce","__privateMethod","html","nothing","severity","sortedMessages","a","b","severityOrder","hasErrorsOrWarnings","m","repeat","msg","color","errorCount","warningCount","UmbTextStyles","__decorateClass","state","customElement"],"mappings":"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"}