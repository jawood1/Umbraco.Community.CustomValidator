{"version":3,"file":"validation-view.element-BfWe9BAi.js","sources":["../../TestExtension/client/src/validation/validation-view.element.ts"],"sourcesContent":["import { customElement, state, html, nothing, repeat } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_CONTENT_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/content';\r\nimport { UMB_DOCUMENT_WORKSPACE_CONTEXT } from \"@umbraco-cms/backoffice/document\";\r\nimport type { UmbWorkspaceViewElement } from '@umbraco-cms/backoffice/workspace';\r\nimport { VALIDATION_WORKSPACE_CONTEXT } from './validation-workspace-context.js';\r\nimport type { ValidationResult, ValidationMessage } from './types.js';\r\n\r\n@customElement('my-validation-workspace-view')\r\nexport class MyValidationWorkspaceView extends UmbLitElement implements UmbWorkspaceViewElement {\r\n    @state()\r\n    private _documentId?: string;\r\n\r\n    @state()\r\n    private _validationResult?: ValidationResult;\r\n\r\n    @state()\r\n    private _isValidating = false;\r\n\r\n    @state()\r\n    private _error?: string;\r\n\r\n    #documentWorkspace?: typeof UMB_DOCUMENT_WORKSPACE_CONTEXT.TYPE;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.consumeContext(UMB_DOCUMENT_WORKSPACE_CONTEXT, (workspace) => {\r\n            if (!workspace) return;\r\n            \r\n            this.#documentWorkspace = workspace;\r\n        });\r\n\r\n        this.consumeContext(UMB_CONTENT_WORKSPACE_CONTEXT, (workspace) => {\r\n            if (!workspace) return;\r\n            \r\n            this.observe(\r\n                workspace.unique,\r\n                (unique) => {\r\n                    this._documentId = unique ?? undefined;\r\n                    \r\n                    // Auto-validate when document ID is available\r\n                    if (unique) {\r\n                        this.#autoValidateOnLoad(unique);\r\n                    }\r\n                }\r\n            );\r\n        });\r\n\r\n        this.consumeContext(VALIDATION_WORKSPACE_CONTEXT, (validationContext) => {\r\n            if (!validationContext) return;\r\n\r\n            this.observe(\r\n                validationContext.validationResult,\r\n                (result) => {\r\n                    this._validationResult = result;\r\n                }\r\n            );\r\n\r\n            this.observe(\r\n                validationContext.isValidating,\r\n                (isValidating) => {\r\n                    this._isValidating = isValidating;\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    async #autoValidateOnLoad(documentId: string) {\r\n        // Auto-validate when component loads to show any blocking errors\r\n        const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n        if (!validationContext) return;\r\n\r\n        // Small delay to ensure workspace is fully loaded\r\n        setTimeout(async () => {\r\n            try {\r\n                await validationContext.validateManually(documentId);\r\n            } catch (error) {\r\n                // Silent fail on auto-validation\r\n                console.debug('Auto-validation skipped:', error);\r\n            }\r\n        }, 1000);\r\n    }\r\n\r\n    override connectedCallback() {\r\n        super.connectedCallback();\r\n        \r\n        // Re-validate when tab becomes visible\r\n        if (this._documentId) {\r\n            this.#revalidateOnTabSwitch();\r\n        }\r\n    }\r\n\r\n    async #revalidateOnTabSwitch() {\r\n        if (!this._documentId) return;\r\n\r\n        const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n        if (!validationContext) return;\r\n\r\n        // Request save to ensure latest content, then validate\r\n        try {\r\n            if (this.#documentWorkspace?.requestSubmit) {\r\n                await this.#documentWorkspace.requestSubmit();\r\n                await new Promise(resolve => setTimeout(resolve, 500));\r\n            }\r\n            await validationContext.validateManually(this._documentId);\r\n        } catch (error) {\r\n            console.debug('Auto-validation on tab switch skipped:', error);\r\n        }\r\n    }\r\n\r\n    #handleValidateClick = async () => {\r\n        if (!this._documentId) return;\r\n\r\n        const validationContext = await this.getContext(VALIDATION_WORKSPACE_CONTEXT);\r\n        if (!validationContext) return;\r\n\r\n        this._error = undefined;\r\n\r\n        try {\r\n            // Request save to update preview content before validation\r\n            if (this.#documentWorkspace?.requestSubmit) {\r\n                await this.#documentWorkspace.requestSubmit();\r\n                // Small delay to allow content cache to update\r\n                await new Promise(resolve => setTimeout(resolve, 500));\r\n            }\r\n            \r\n            await validationContext.validateManually(this._documentId);\r\n        } catch (error) {\r\n            this._error = error instanceof Error ? error.message : 'Validation failed';\r\n        }\r\n    };\r\n\r\n    #getSeverityColor(severity: string): string {\r\n        switch (severity.toLowerCase()) {\r\n            case 'error':\r\n                return 'danger';\r\n            case 'warning':\r\n                return 'warning';\r\n            case 'info':\r\n                return 'positive';\r\n            default:\r\n                return 'default';\r\n        }\r\n    }\r\n\r\n    #renderError() {\r\n        if (!this._error) return nothing;\r\n\r\n        return html`\r\n            <uui-box headline=\"Error\" headline-variant=\"h5\">\r\n                <p><strong style=\"color: var(--uui-color-danger);\">${this._error}</strong></p>\r\n            </uui-box>\r\n        `;\r\n    }\r\n\r\n    #renderEmptyState() {\r\n        if (!this._validationResult) return nothing;\r\n\r\n        if (!this._validationResult.hasValidator) {\r\n            return html`\r\n                <uui-box headline=\"No Validator Available\" headline-variant=\"h5\">\r\n                    <p>No validation configured for this content type (${this._validationResult.contentTypeAlias}).</p>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        if (this._validationResult.messages.length === 0) {\r\n            return html`\r\n                <uui-box headline=\"Validation Complete\" headline-variant=\"h5\">\r\n                    <p style=\"color: var(--uui-color-positive);\">\r\n                        <uui-icon name=\"icon-check\"></uui-icon>\r\n                        All validations passed successfully.\r\n                    </p>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        return nothing;\r\n    }\r\n\r\n    #renderValidationMessages() {\r\n        if (!this._validationResult || this._validationResult.messages.length === 0) {\r\n            return nothing;\r\n        }\r\n\r\n        return html`\r\n            <uui-box headline=\"Validation Results\" headline-variant=\"h5\">\r\n                <div>\r\n                    ${repeat(\r\n                        this._validationResult.messages,\r\n                        (msg) => msg.message,\r\n                        (msg) => this.#renderValidationMessage(msg)\r\n                    )}\r\n                </div>\r\n            </uui-box>\r\n        `;\r\n    }\r\n\r\n    #renderValidationMessage(msg: ValidationMessage) {\r\n        const color = this.#getSeverityColor(msg.severity);\r\n\r\n        return html`\r\n            <p>\r\n                <uui-tag color=${color} look=\"primary\">\r\n                    ${msg.severity}\r\n                </uui-tag>\r\n                ${msg.message}\r\n                ${msg.propertyAlias ? html`\r\n                    <span style=\"color: var(--uui-color-text-alt);\">(${msg.propertyAlias})</span>\r\n                ` : nothing}\r\n            </p>\r\n        `;\r\n    }\r\n\r\n    #getErrorCount(): number {\r\n        if (!this._validationResult) return 0;\r\n        return this._validationResult.messages.filter(m => m.severity === 'Error').length;\r\n    }\r\n\r\n    #getWarningCount(): number {\r\n        if (!this._validationResult) return 0;\r\n        return this._validationResult.messages.filter(m => m.severity === 'Warning').length;\r\n    }\r\n\r\n    #renderHeader() {\r\n        const errorCount = this.#getErrorCount();\r\n        const warningCount = this.#getWarningCount();\r\n\r\n        return html`\r\n            <div slot=\"headline\">\r\n                ${errorCount > 0 ? html`\r\n                    <uui-icon name=\"icon-delete\" style=\"color: var(--uui-color-danger);\"></uui-icon>\r\n                ` : html`\r\n                    <uui-icon name=\"icon-check\" style=\"color: var(--uui-color-positive);\"></uui-icon>\r\n                `}\r\n                Document Validation\r\n            </div>\r\n            <div slot=\"header-actions\">\r\n                ${errorCount > 0 ? html`\r\n                    <uui-tag color=\"danger\" look=\"primary\">${errorCount}</uui-tag>\r\n                ` : nothing}\r\n                ${warningCount > 0 ? html`\r\n                    <uui-tag color=\"warning\" look=\"primary\">${warningCount}</uui-tag>\r\n                ` : nothing}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    override render() {\r\n        return html`\r\n            <umb-body-layout header-transparent header-fit-height>\r\n                <div style=\"display: flex; flex-direction: column; gap: var(--uui-size-layout-1);\">\r\n                    <uui-box headline-variant=\"h4\">\r\n                        ${this.#renderHeader()}\r\n                        <uui-button-group>\r\n                            <uui-button\r\n                                look=\"primary\"\r\n                                color=\"positive\"\r\n                                label=\"Validate Document\"\r\n                                @click=${this.#handleValidateClick}\r\n                                ?disabled=${!this._documentId || this._isValidating}>\r\n                                <uui-icon name=\"icon-check\"></uui-icon>\r\n                                Validate Document\r\n                            </uui-button>\r\n                            ${this._isValidating ? html`<uui-loader></uui-loader>` : nothing}\r\n                        </uui-button-group>\r\n                    </uui-box>\r\n\r\n                    ${this.#renderError()}\r\n                    ${this.#renderEmptyState()}\r\n                    ${this.#renderValidationMessages()}\r\n                </div>\r\n            </umb-body-layout>\r\n        `;\r\n    }\r\n\r\n    static override styles = [UmbTextStyles];\r\n}\r\n\r\nexport { MyValidationWorkspaceView as element };\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'my-validation-workspace-view': MyValidationWorkspaceView;\r\n    }\r\n}\r\n"],"names":["_documentWorkspace","_MyValidationWorkspaceView_instances","autoValidateOnLoad_fn","revalidateOnTabSwitch_fn","_handleValidateClick","getSeverityColor_fn","renderError_fn","renderEmptyState_fn","renderValidationMessages_fn","renderValidationMessage_fn","getErrorCount_fn","getWarningCount_fn","renderHeader_fn","MyValidationWorkspaceView","UmbLitElement","__privateAdd","validationContext","VALIDATION_WORKSPACE_CONTEXT","__privateGet","resolve","error","UMB_DOCUMENT_WORKSPACE_CONTEXT","workspace","__privateSet","UMB_CONTENT_WORKSPACE_CONTEXT","unique","__privateMethod","result","isValidating","html","nothing","documentId","severity","repeat","msg","color","m","errorCount","warningCount","UmbTextStyles","__decorateClass","state","customElement"],"mappings":";;;;;;;;;;;;wYAAAA,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAUO,IAAMC,IAAN,cAAwCC,EAAiD;AAAA,EAe5F,cAAc;AACV,UAAA,GAhBDC,EAAA,MAAAd,CAAA,GAQH,KAAQ,gBAAgB,IAKxBc,EAAA,MAAAf,CAAA,GAyFAe,EAAA,MAAAX,GAAuB,YAAY;AAC/B,UAAI,CAAC,KAAK,YAAa;AAEvB,YAAMY,IAAoB,MAAM,KAAK,WAAWC,CAA4B;AAC5E,UAAKD,GAEL;AAAA,aAAK,SAAS;AAEd,YAAI;AAEA,UAAIE,EAAA,MAAKlB,IAAoB,kBACzB,MAAMkB,EAAA,MAAKlB,GAAmB,cAAA,GAE9B,MAAM,IAAI,QAAQ,CAAAmB,MAAW,WAAWA,GAAS,GAAG,CAAC,IAGzD,MAAMH,EAAkB,iBAAiB,KAAK,WAAW;AAAA,QAC7D,SAASI,GAAO;AACZ,eAAK,SAASA,aAAiB,QAAQA,EAAM,UAAU;AAAA,QAC3D;AAAA;AAAA,IACJ,CAAA,GAxGI,KAAK,eAAeC,GAAgC,CAACC,MAAc;AAC/D,MAAKA,KAELC,EAAA,MAAKvB,GAAqBsB,CAAA;AAAA,IAC9B,CAAC,GAED,KAAK,eAAeE,GAA+B,CAACF,MAAc;AAC9D,MAAKA,KAEL,KAAK;AAAA,QACDA,EAAU;AAAA,QACV,CAACG,MAAW;AACR,eAAK,cAAcA,KAAU,QAGzBA,KACAC,EAAA,MAAKzB,MAAL,KAAA,MAAyBwB,CAAA;AAAA,QAEjC;AAAA,MAAA;AAAA,IAER,CAAC,GAED,KAAK,eAAeR,GAA8B,CAACD,MAAsB;AACrE,MAAKA,MAEL,KAAK;AAAA,QACDA,EAAkB;AAAA,QAClB,CAACW,MAAW;AACR,eAAK,oBAAoBA;AAAA,QAC7B;AAAA,MAAA,GAGJ,KAAK;AAAA,QACDX,EAAkB;AAAA,QAClB,CAACY,MAAiB;AACd,eAAK,gBAAgBA;AAAA,QACzB;AAAA,MAAA;AAAA,IAER,CAAC;AAAA,EACL;AAAA,EAkBS,oBAAoB;AACzB,UAAM,kBAAA,GAGF,KAAK,eACLF,EAAA,MAAKzB,GAAAE,CAAA,EAAL,KAAA,IAAA;AAAA,EAER;AAAA,EA8JS,SAAS;AACd,WAAO0B;AAAA;AAAA;AAAA;AAAA,0BAIWH,EAAA,MAAKzB,MAAL,KAAA,IAAA,CAAoB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCAMLiB,QAAKd,CAAA,CAAoB;AAAA,4CACtB,CAAC,KAAK,eAAe,KAAK,aAAa;AAAA;AAAA;AAAA;AAAA,8BAIrD,KAAK,gBAAgByB,+BAAkCC,CAAO;AAAA;AAAA;AAAA;AAAA,sBAItEJ,EAAA,MAAKzB,MAAL,KAAA,IAAA,CAAmB;AAAA,sBACnByB,EAAA,MAAKzB,MAAL,KAAA,IAAA,CAAwB;AAAA,sBACxByB,EAAA,MAAKzB,MAAL,KAAA,IAAA,CAAgC;AAAA;AAAA;AAAA;AAAA,EAIlD;AAGJ;AAhQID,IAAA,oBAAA,QAAA;AAbGC,IAAA,oBAAA,QAAA;AA2DGC,IAAmB,eAAC6B,GAAoB;AAE1C,QAAMf,IAAoB,MAAM,KAAK,WAAWC,CAA4B;AAC5E,EAAKD,KAGL,WAAW,YAAY;AACnB,QAAI;AACA,YAAMA,EAAkB,iBAAiBe,CAAU;AAAA,IACvD,SAASX,GAAO;AAEZ,cAAQ,MAAM,4BAA4BA,CAAK;AAAA,IACnD;AAAA,EACJ,GAAG,GAAI;AACX;AAWMjB,IAAsB,iBAAG;AAC3B,MAAI,CAAC,KAAK,YAAa;AAEvB,QAAMa,IAAoB,MAAM,KAAK,WAAWC,CAA4B;AAC5E,MAAKD;AAGL,QAAI;AACA,MAAIE,EAAA,MAAKlB,IAAoB,kBACzB,MAAMkB,EAAA,MAAKlB,GAAmB,cAAA,GAC9B,MAAM,IAAI,QAAQ,CAAAmB,MAAW,WAAWA,GAAS,GAAG,CAAC,IAEzD,MAAMH,EAAkB,iBAAiB,KAAK,WAAW;AAAA,IAC7D,SAASI,GAAO;AACZ,cAAQ,MAAM,0CAA0CA,CAAK;AAAA,IACjE;AACJ;AAEAhB,IAAA,oBAAA,QAAA;AAsBAC,IAAiB,SAAC2B,GAA0B;AACxC,UAAQA,EAAS,eAAY;AAAA,IACzB,KAAK;AACD,aAAO;AAAA,IACX,KAAK;AACD,aAAO;AAAA,IACX,KAAK;AACD,aAAO;AAAA,IACX;AACI,aAAO;AAAA,EAAA;AAEnB;AAEA1B,IAAY,WAAG;AACX,SAAK,KAAK,SAEHuB;AAAA;AAAA,qEAEsD,KAAK,MAAM;AAAA;AAAA,YAJ/CC;AAO7B;AAEAvB,IAAiB,WAAG;AAChB,SAAK,KAAK,oBAEL,KAAK,kBAAkB,eAQxB,KAAK,kBAAkB,SAAS,WAAW,IACpCsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAUJC,IAlBID;AAAA;AAAA,yEAEsD,KAAK,kBAAkB,gBAAgB;AAAA;AAAA,gBALpEC;AAsBxC;AAEAtB,IAAyB,WAAG;AACxB,SAAI,CAAC,KAAK,qBAAqB,KAAK,kBAAkB,SAAS,WAAW,IAC/DsB,IAGJD;AAAA;AAAA;AAAA,sBAGOI;AAAA,IACE,KAAK,kBAAkB;AAAA,IACvB,CAACC,MAAQA,EAAI;AAAA,IACb,CAACA,MAAQR,EAAA,MAAKzB,GAAAQ,CAAA,EAAL,KAAA,MAA8ByB,CAAA;AAAA,EAAA,CAC1C;AAAA;AAAA;AAAA;AAIjB;AAEAzB,IAAwB,SAACyB,GAAwB;AAC7C,QAAMC,IAAQT,EAAA,MAAKzB,GAAAI,CAAA,EAAL,KAAA,MAAuB6B,EAAI,QAAA;AAEzC,SAAOL;AAAA;AAAA,iCAEkBM,CAAK;AAAA,sBAChBD,EAAI,QAAQ;AAAA;AAAA,kBAEhBA,EAAI,OAAO;AAAA,kBACXA,EAAI,gBAAgBL;AAAA,uEACiCK,EAAI,aAAa;AAAA,oBACpEJ,CAAO;AAAA;AAAA;AAGvB;AAEApB,IAAc,WAAW;AACrB,SAAK,KAAK,oBACH,KAAK,kBAAkB,SAAS,OAAO,OAAK0B,EAAE,aAAa,OAAO,EAAE,SADvC;AAExC;AAEAzB,IAAgB,WAAW;AACvB,SAAK,KAAK,oBACH,KAAK,kBAAkB,SAAS,OAAO,OAAKyB,EAAE,aAAa,SAAS,EAAE,SADzC;AAExC;AAEAxB,IAAa,WAAG;AACZ,QAAMyB,IAAaX,QAAKzB,GAAAS,CAAA,EAAL,KAAA,IAAA,GACb4B,IAAeZ,QAAKzB,GAAAU,CAAA,EAAL,KAAA,IAAA;AAErB,SAAOkB;AAAA;AAAA,kBAEGQ,IAAa,IAAIR;AAAA;AAAA,oBAEfA;AAAA;AAAA,iBAEH;AAAA;AAAA;AAAA;AAAA,kBAICQ,IAAa,IAAIR;AAAA,6DAC0BQ,CAAU;AAAA,oBACnDP,CAAO;AAAA,kBACTQ,IAAe,IAAIT;AAAA,8DACyBS,CAAY;AAAA,oBACtDR,CAAO;AAAA;AAAA;AAGvB;AA9OSjB,EA4QO,SAAS,CAAC0B,CAAa;AA1Q/BC,EAAA;AAAA,EADPC,EAAA;AAAM,GADE5B,EAED,WAAA,eAAA,CAAA;AAGA2B,EAAA;AAAA,EADPC,EAAA;AAAM,GAJE5B,EAKD,WAAA,qBAAA,CAAA;AAGA2B,EAAA;AAAA,EADPC,EAAA;AAAM,GAPE5B,EAQD,WAAA,iBAAA,CAAA;AAGA2B,EAAA;AAAA,EADPC,EAAA;AAAM,GAVE5B,EAWD,WAAA,UAAA,CAAA;AAXCA,IAAN2B,EAAA;AAAA,EADNE,EAAc,8BAA8B;AAAA,GAChC7B,CAAA;"}