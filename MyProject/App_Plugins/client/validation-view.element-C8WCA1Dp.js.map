{"version":3,"file":"validation-view.element-C8WCA1Dp.js","sources":["../../TestExtension/client/src/validation/validation-api.service.ts","../../TestExtension/client/src/validation/validation-view.element.ts"],"sourcesContent":["import type { ValidationResult } from './types.js';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UMB_AUTH_CONTEXT } from '@umbraco-cms/backoffice/auth';\r\n\r\nexport class ValidationApiService extends UmbControllerBase {\r\n    constructor(host: UmbControllerHost) {\r\n        super(host);\r\n    }\r\n\r\n    async validateDocument(id: string): Promise<ValidationResult> {\r\n        const authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n        const token = await authContext?.getLatestToken();\r\n\r\n        const response = await fetch(`/umbraco/management/api/v1/validation/validate/${id}`, {\r\n            method: 'GET',\r\n            headers: {\r\n                'Authorization': `Bearer ${token}`,\r\n                'Content-Type': 'application/json',\r\n            },\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Validation request failed: ${response.statusText}`);\r\n        }\r\n\r\n        return await response.json();\r\n    }\r\n}\r\n","import { customElement, state, html, nothing, repeat } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_CONTENT_WORKSPACE_CONTEXT } from '@umbraco-cms/backoffice/content';\r\nimport type { UmbWorkspaceViewElement } from '@umbraco-cms/backoffice/workspace';\r\nimport { ValidationApiService } from './validation-api.service.js';\r\nimport type { ValidationResult, ValidationMessage } from './types.js';\r\n\r\n@customElement('my-validation-workspace-view')\r\nexport class MyValidationWorkspaceView extends UmbLitElement implements UmbWorkspaceViewElement {\r\n    #apiService = new ValidationApiService(this);\r\n\r\n    @state()\r\n    private _documentId?: string;\r\n\r\n    @state()\r\n    private _validationResult?: ValidationResult;\r\n\r\n    @state()\r\n    private _isLoading = false;\r\n\r\n    @state()\r\n    private _error?: string;\r\n\r\n    constructor() {\r\n        super();\r\n\r\n        this.consumeContext(UMB_CONTENT_WORKSPACE_CONTEXT, (workspace) => {\r\n            if (!workspace) return;\r\n            \r\n            this.observe(\r\n                workspace.unique,\r\n                (unique) => {\r\n                    this._documentId = unique ?? undefined;\r\n                }\r\n            );\r\n        });\r\n    }\r\n\r\n    #handleValidateClick = async () => {\r\n        if (!this._documentId) return;\r\n\r\n        this._isLoading = true;\r\n        this._error = undefined;\r\n\r\n        try {\r\n            this._validationResult = await this.#apiService.validateDocument(this._documentId);\r\n        } catch (error) {\r\n            this._error = error instanceof Error ? error.message : 'Validation failed';\r\n        } finally {\r\n            this._isLoading = false;\r\n        }\r\n    };\r\n\r\n    #getSeverityColor(severity: string): string {\r\n        switch (severity.toLowerCase()) {\r\n            case 'error':\r\n                return 'danger';\r\n            case 'warning':\r\n                return 'warning';\r\n            case 'info':\r\n                return 'positive';\r\n            default:\r\n                return 'default';\r\n        }\r\n    }\r\n\r\n    #renderError() {\r\n        if (!this._error) return nothing;\r\n\r\n        return html`\r\n            <uui-box headline=\"Error\">\r\n                <div style=\"color: var(--uui-color-danger);\">\r\n                    ${this._error}\r\n                </div>\r\n            </uui-box>\r\n        `;\r\n    }\r\n\r\n    #renderEmptyState() {\r\n        if (!this._validationResult) return nothing;\r\n\r\n        if (!this._validationResult.hasValidator) {\r\n            return html`\r\n                <uui-box headline=\"No Validator Available\">\r\n                    <p>No validation configured for this content type (${this._validationResult.contentTypeAlias}).</p>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        if (this._validationResult.messages.length === 0) {\r\n            return html`\r\n                <uui-box headline=\"Validation Complete\">\r\n                    <p>No validation messages.</p>\r\n                </uui-box>\r\n            `;\r\n        }\r\n\r\n        return nothing;\r\n    }\r\n\r\n    #renderValidationMessages() {\r\n        if (!this._validationResult || this._validationResult.messages.length === 0) {\r\n            return nothing;\r\n        }\r\n\r\n        return html`\r\n            <uui-box headline=\"Validation Results\">\r\n                ${repeat(\r\n                    this._validationResult.messages,\r\n                    (msg) => msg.message,\r\n                    (msg) => this.#renderValidationMessage(msg)\r\n                )}\r\n            </uui-box>\r\n        `;\r\n    }\r\n\r\n    #renderValidationMessage(msg: ValidationMessage) {\r\n        const color = this.#getSeverityColor(msg.severity);\r\n\r\n        return html`\r\n            <div class=\"validation-message\">\r\n                <uui-badge color=${color} look=\"primary\">\r\n                    ${msg.severity}\r\n                </uui-badge>\r\n                <span class=\"message-text\">${msg.message}</span>\r\n                ${msg.propertyAlias ? html`\r\n                    <span class=\"property-alias\">(${msg.propertyAlias})</span>\r\n                ` : nothing}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    override render() {\r\n        return html`\r\n            <style>\r\n                .container {\r\n                    display: flex;\r\n                    flex-direction: column;\r\n                    gap: var(--uui-size-space-4);\r\n                    padding: var(--uui-size-layout-1);\r\n                }\r\n\r\n                .actions {\r\n                    display: flex;\r\n                    align-items: center;\r\n                    gap: var(--uui-size-space-3);\r\n                }\r\n\r\n                .validation-message {\r\n                    display: flex;\r\n                    align-items: center;\r\n                    gap: var(--uui-size-space-3);\r\n                    padding: var(--uui-size-space-3);\r\n                }\r\n\r\n                .validation-message:last-child {\r\n                    border-bottom: none;\r\n                }\r\n\r\n                .message-text {\r\n                    flex: 1;\r\n                }\r\n\r\n                .property-alias {\r\n                    color: var(--uui-color-text-alt);\r\n                    font-size: 0.9em;\r\n                }\r\n            </style>\r\n            <div class=\"container\">${this.#renderContent()}</div>\r\n        `;\r\n    }\r\n\r\n    #renderContent() {\r\n        return html`\r\n            <div class=\"container\">\r\n                <uui-box>\r\n                    <div slot=\"headline\">Document Validation</div>\r\n                    <div class=\"actions\">\r\n                        <uui-button\r\n                            look=\"primary\"\r\n                            color=\"positive\"\r\n                            @click=${this.#handleValidateClick}\r\n                            ?disabled=${!this._documentId || this._isLoading}>\r\n                            <uui-icon name=\"icon-check\"></uui-icon>\r\n                            Validate Document\r\n                        </uui-button>\r\n                        ${this._isLoading ? html`<uui-loader></uui-loader>` : nothing}\r\n                    </div>\r\n                </uui-box>\r\n\r\n                ${this.#renderError()}\r\n                ${this.#renderEmptyState()}\r\n                ${this.#renderValidationMessages()}\r\n            </div>\r\n        `;\r\n    }\r\n\r\n    static override styles = [UmbTextStyles];\r\n}\r\n\r\nexport { MyValidationWorkspaceView as element };\r\n\r\ndeclare global {\r\n    interface HTMLElementTagNameMap {\r\n        'my-validation-workspace-view': MyValidationWorkspaceView;\r\n    }\r\n}\r\n"],"names":["ValidationApiService","UmbControllerBase","host","id","token","UMB_AUTH_CONTEXT","response","_apiService","_handleValidateClick","_MyValidationWorkspaceView_instances","getSeverityColor_fn","renderError_fn","renderEmptyState_fn","renderValidationMessages_fn","renderValidationMessage_fn","renderContent_fn","MyValidationWorkspaceView","UmbLitElement","__privateAdd","__privateGet","error","UMB_CONTENT_WORKSPACE_CONTEXT","workspace","unique","html","__privateMethod","severity","nothing","repeat","msg","color","UmbTextStyles","__decorateClass","state","customElement"],"mappings":"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"}